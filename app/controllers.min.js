/* angular-qpme 2016-12-15 */app.controller("activateController",function($scope,$location,$routeParams,$http,$rootScope,appConfig,$cookieStore){var uid=$routeParams.uid;console.log(uid),$scope.activate={},$scope.activate.uid=uid,$scope.activate.password="",$scope.submit_disabled=!0,$scope.$watch("activate",function(){console.log("changed"),$scope.activate.password.length<7&&$scope.activate.password.length>0?($scope.login_error=!0,$scope.error_txt="Password is too short (Minimum 8).",$scope.submit_disabled=!0):$scope.activate.password!=$scope.activate.new_password&&$scope.activate.password.length>7?($scope.login_error=!0,$scope.error_txt="Passwords do not match.",$scope.submit_disabled=!0):($scope.login_error=!1,$scope.submit_disabled=!1)},!0),$scope.passwordSet=function(){if($scope.submit_disabled!==!1)$scope.activate.login_error=!0;else{var url="https://"+appConfig.domain+"/user/password";$http.put(url,$scope.activate,config).success(function(data,status,headers,config){console.log(data)}).error(function(data,status,header,config){console.log(data)});var url2="https://"+appConfig.domain+"/user/activate";$http.put(url2,$scope.activate,config).success(function(data,status,headers,config){console.log(data)}).error(function(data,status,header,config){console.log(data)})["finally"](function(){$cookieStore.remove("user"),$location.path("/")})}}}),app.controller("addEmployeeController",function($scope,$location,$http,appConfig,$rootScope,$cookieStore,locationService){$scope.employee={},$scope.add_employee=function(){({badge_encode_number:$scope.employee.badge_encode_number,email:$scope.employee.email,job_title:$scope.employee.job_title,name_suffix:$scope.employee.name_suffix,first_name:$scope.employee.first_name,middle_name:$scope.employee.middle_name,last_name:$scope.employee.last_name,location_code:$scope.employee.location_code,location_description:$scope.employee.location_description,ccf_mail_code:$scope.employee.ccf_mail_code,division:$scope.employee.division,department_name:$scope.employee.department_name,supervisor_firt_name:$scope.employee.supervisor_firt_name,supervisor_last_name:$scope.employee.supervisor_last_name,hire_date:$scope.employee.hire_date,termination_date:$scope.employee.termination_date,create_time:$scope.employee.create_time,tag_number:$scope.employee.tag_number});$http({method:"POST",url:"https://"+appConfig.domain+"/employee",data:$scope.employee,headers:{"Content-Type":"application/json",Authorization:"Basic "+$rootScope.user.basicAuth}}).success(function(data,status){console.log(data),data.error?$scope.error_text=data.msg:$location.path("/employees")}).error(function(data,status,headers,config){console.log(data)})}}),app.controller("basicController",function($scope,$log){this.product=gem,this.items=item,$scope.$log=$log,$scope.log_message="This is a logged message",$scope.info_message="This is an info message",$scope.warn_message="This is a warning message",$scope.error_message="This is an error form message",$log.log($scope.log_message),$log.info($scope.info_message),$log.warn($scope.warn_message),$log.error($scope.error_message)}),app.controller("dashboardController",function($scope,$location,$http,appConfig,$rootScope){function daysInMonth(month,year){return new Date(year,month,0).getDate()}function next_day(i){var today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();if(10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm),dd=Number(dd-i),1>dd){var dx=-1*dd;mm=today.getMonth(),dd=daysInMonth(mm,yyyy),dd=Number(dd-dx)}today=mm+"/"+dd+"/"+yyyy;var unix_date=new Date(today.split("/").join("-")).getTime()/1e3;days_data.push(unix_date),days.push(today),get_data(unix_date)}function get_data(unix_date){console.log(unix_date),$http({method:"GET",url:"https://"+appConfig.domain+"/permit/day/"+unix_date+"/"+$scope.user.uid,headers:{"Content-Type":"application/json",Authorization:"Basic "+$rootScope.user.basicAuth}}).success(function(data,status,headers,config){var permits=data.length;chart_data.push(permits)}).error(function(data,status,headers,config){console.log(data)})["finally"](function(data){6==days_data.length?($scope.loaded=!0,build_chart(chart_data)):(count++,next_day(count))})}function build_chart(chart_data){var data={labels:days,datasets:[{label:"Permits",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:chart_data}]},options={showScale:!0,scaleOverride:!1,maintainAspectRatio:!0,responsive:!0},ctx=document.getElementById("myChart").getContext("2d");new Chart(ctx).Bar(data,options)}$scope.domain=appConfig.domain,$scope.user=$rootScope.user.info,console.log($scope.user);var days=[],days_data=[],chart_data=[],count=0;$scope.loaded=!1,next_day(0),$scope.currentPermits=function(){var unix_time=Math.round((new Date).getTime()/1e3);console.log(unix_time),$http({method:"GET",url:"https://"+appConfig.domain+"/permit/current/"+$scope.user.uid+"/"+unix_time,headers:{"Content-Type":"application/json",Authorization:"Basic "+$rootScope.user.basicAuth}}).success(function(data_parked,status,headers,config){$scope.permit_number=data_parked.data.length,console.log(data_parked.data)}).error(function(data,status,headers,config){console.log(data)})},$scope.currentPermits()}),app.controller("employeesController",function($scope,$location,$http,appConfig,$rootScope,$cookieStore,locationService){console.log($rootScope.user),$scope.user=$rootScope.user.info,$scope.employees=function(){$http({method:"GET",url:"https://"+appConfig.domain+"/employees",headers:{"Content-Type":"application/json",Authorization:"Basic "+$rootScope.user.basicAuth}}).success(function(employees,status,headers,config){console.log(employees),employees.data.length<1&&($scope.no_employees=!0);var columns=[{sTitle:"badge_encode_number",mData:"badge_encode_number"},{sTitle:"email",mData:"email"},{sTitle:"job_title",mData:"job_title"},{sTitle:"name_suffix",mData:"name_suffix"},{sTitle:"first_name",mData:"first_name"},{sTitle:"middle_name",mData:"middle_name"},{sTitle:"last_name",mData:"last_name"},{sTitle:"location_code",mData:"location_code"},{sTitle:"location_description",mData:"location_description"},{sTitle:"ccf_mail_code",mData:"ccf_mail_code"},{sTitle:"division",mData:"division"},{sTitle:"department_name",mData:"department_name"},{sTitle:"supervisor_firt_name",mData:"supervisor_firt_name"},{sTitle:"supervisor_last_name",mData:"supervisor_last_name"},{sTitle:"hire_date",mData:"hire_date"},{sTitle:"termination_date",mData:"termination_date"},{sTitle:"tag_number",mData:"tag_number"}];$("#employees-table").dataTable({data:employees.data,columns:columns})}).error(function(data,status,headers,config){console.log(data)})},$scope.employees()}),app.controller("findEmployeeController",function($scope,$location,$http,appConfig,$rootScope,$cookieStore,locationService){console.log($rootScope.user),$scope.user=$rootScope.user.info,$scope.employees=function(){var unix_time=Math.round((new Date).getTime()/1e3);console.log(unix_time),console.log(unix_time-14400),unix_time-=14400;var t=new Date(1e3*unix_time);$scope.current_unit_time=t,$http({method:"GET",url:"https://"+appConfig.domain+"/permit/hotel/"+$scope.user.hotel_id+"/current/"+$scope.user.uid+"/"+unix_time,headers:{"Content-Type":"application/json",Authorization:"Basic "+$rootScope.user.basicAuth}}).success(function(data_parked,status,headers,config){console.log(data_parked.data),data_parked.data.length<1&&($scope.no_permits=!0);var columns=[{sTitle:"Create Time",mData:"CreateTime"},{sTitle:"Begin Time",mData:"BeginTime"},{sTitle:"Expiry Time",mData:"ExpiryTime"},{sTitle:"Suit Id",mData:"SuiteId"},{sTitle:"Permit Class",mData:"PermitClass"},{sTitle:"First Name",mData:"FirstName"},{sTitle:"Last Name",mData:"LastName"},{sTitle:"Phone",mData:"Phone"},{sTitle:"Email",mData:"Email"},{sTitle:"LPN",mData:"LPN"},{sTitle:"Make",mData:"Make"},{sTitle:"Model",mData:"Model"},{sTitle:"Color",mData:"Color"},{sTitle:"Permit Tag",mData:"PermitTag"}];$("#current-permits-table").dataTable({data:data_parked.data,columns:columns})}).error(function(data,status,headers,config){console.log(data)})},$scope.employees()}),app.controller("loginController",function($scope,$location,$http,$rootScope,appConfig,$cookieStore){$scope.login={},$rootScope.user={},$scope.password_email=!1,$scope.auth=function(login){console.log(login);var auth=Base64.encode(login.username+":"+login.password);$http({method:"GET",url:appConfig.proxy+"://"+appConfig.domain+"/login",headers:{"Content-Type":"application/json",Authorization:"Basic "+auth}}).success(function(data,status,headers,config){console.log(data),$scope.login_error=!1;var username=login.username;$rootScope.user.basicAuth=auth,$rootScope.user.info=data[0],$rootScope.user.login=username,$cookieStore.put("user",$rootScope.user),console.log($rootScope.user),$location.path("/find-employee"),$("#top-nav").show()}).error(function(data,status,headers,config){$scope.login_error=!0})},$scope.forgot_password=function(){var url="https://"+appConfig.domain+"/user/password_reset";$http.post(url,$scope.login_forgot,config).success(function(data,status,headers,config){console.log(data),data.user===!1?$scope.user_error=!0:($scope.user_error=!1,$scope.password_email=!0)}).error(function(data,status,header,config){console.log(data)})},$scope.reload=function(){location.reload()}}),app.controller("mainController",function($scope,$rootScope,$location){$scope.message="This is a homepage message",this.booger=function(){alert('Uses the "this"')},$scope.booger=function(){alert('Uses the "$scope"'),$(".boogerTitle").html("Changed by Jquery")}}),app.controller("navController",function($scope,$location,$rootScope,$cookieStore){$scope.user=$rootScope.user.info,"master"!=$scope.user.user_type&&"admin"!=$scope.user.user_type||($scope.admin_show=!0),$scope.logout=function(){$cookieStore.remove("user"),$location.path("/"),window.location.reload(!0)},$scope.reports=function(){$(".sub-reports").toggleClass("active-list"),$(".nav-expand").toggleClass("chevron-down"),$(".reports-link").toggleClass("down")}}),app.controller("tabController",function(){this.tab=1,this.selectTab=function(setTab){this.tab=setTab},this.isSelected=function(checkTab){return this.tab===checkTab}}),app.controller("topNavController",function($scope,$location,$rootScope,$cookieStore){$scope.logout=function(){$cookieStore.remove("user"),$location.path("/"),window.location.reload(!0)},$scope.menu=function(){$("#wrapper").toggleClass("toggled"),$(".menu-open").toggleClass("closed")},"/"!==$location.path()&&"/activate"!==$location.path()||$("#top-nav").hide()}),app.controller("userProfileController",function($scope,$location,$http,appConfig,$rootScope,$cookieStore,locationService){console.log($rootScope.user),$scope.user=$rootScope.user.info,$scope.reset={},$scope.reset.uid=$scope.user.uid,$scope.save_profile=function(){$http({method:"PUT",url:"https://"+appConfig.domain+"/user",data:$scope.user,headers:{"Content-Type":"application/json",Authorization:"Basic "+$rootScope.user.basicAuth}}).success(function(data,status,headers,config){console.log(data),$scope.user=data.data,$rootScope.user.info=data.data,$cookieStore.put("user",$rootScope.user),console.log($rootScope.user.info)}).error(function(data,status,header,config){console.log(data)})["finally"](function(){location.reload()})},$scope.passwordSet=function(){console.log($scope.activate);var url="https://"+appConfig.domain+"/user/password";$http.put(url,$scope.reset,config).success(function(data,status,headers,config){console.log(data)}).error(function(data,status,header,config){console.log(data)})["finally"](function(){$scope.password_input=!1;var auth=Base64.encode($scope.user.user+":"+$scope.reset.password);$http({method:"GET",url:"https://"+appConfig.domain+"/login",headers:{"Content-Type":"application/json",Authorization:"Basic "+auth}}).success(function(data,status,headers,config){console.log(data),$rootScope.user.basicAuth=auth,$cookieStore.put("user",$rootScope.user)}).error(function(data,status,headers,config){console.log(data)})})}});